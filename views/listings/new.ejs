<% layout("listings/layouts/boilerplate") %>
<body class="bg-light">
  <div class="container py-4">
    <div class="row justify-content-center">
      <div class="col-lg-6 col-md-8">
        <div class="card shadow border-0 rounded-4">
          <div class="card-body p-3">
            <h2 class="text-center mb-3 fw-bold text-danger fs-4">
              Create a New Listing
            </h2>
            <form
              method="POST"
              action="/listings"
              enctype="multipart/form-data"
              class="needs-validation"
              novalidate
            >
              <!-- Title -->
              <div class="mb-2">
                <label class="form-label fw-semibold small">Title</label>
                <input
                  name="listing[title]"
                  type="text"
                  class="form-control"
                  required
                />
              </div>
              <!-- Description -->
              <div class="mb-2">
                <label class="form-label fw-semibold small">Description</label>
                <textarea
                  name="listing[description]"
                  class="form-control"
                  rows="2"
                  required
                ></textarea>
              </div>
              <!-- Image -->
              <div class="mb-2">
                <label class="form-label fw-semibold small">Upload Image</label>
                <input
                  id="imageFile"
                  name="image"
                  type="file"
                  class="form-control"
                  accept="image/*"
                  onchange="previewAndCheckSize(event)"
                  required
                />
                <small class="text-muted">Max 10 MB</small>
                <img
                  id="imagePreview"
                  src="#"
                  alt="Image Preview"
                  style="
                    display: none;
                    max-height: 200px;
                    margin-top: 10px;
                    border-radius: 5px;
                  "
                />
                <p
                  id="sizeWarning"
                  class="text-danger small mt-1"
                  style="display: none"
                >
                  ⚠️ File is larger than 10MB!
                </p>
              </div>
              <!-- Price -->
              <div class="mb-2">
                <label class="form-label fw-semibold small">Price</label>
                <input
                  name="listing[price]"
                  type="number"
                  class="form-control"
                  required
                />
              </div>
              <!-- Country & Location -->
              <div class="row mb-2">
                <div class="col-md-6">
                  <label class="form-label fw-semibold small">Country</label>
                  <input
                    name="listing[country]"
                    type="text"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold small">Location</label>
                  <input
                    name="listing[location]"
                    type="text"
                    class="form-control"
                    required
                  />
                </div>
              </div>
              <button type="submit" class="btn btn-danger w-100">
                + Add Listing
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function previewAndCheckSize(event) {
      const input = event.target;
      const preview = document.getElementById("imagePreview");
      const warning = document.getElementById("sizeWarning");

      if (input.files && input.files[0]) {
        const file = input.files[0];

        // Check file size
        if (file.size > 10 * 1024 * 1024) {
          // 10 MB
          warning.style.display = "block";
          preview.style.display = "none";
        } else {
          warning.style.display = "none";
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      } else {
        preview.style.display = "none";
        warning.style.display = "none";
      }
    }
  </script>
</body>
